# iOS/macOS Template Appfile
# This file contains app and team configuration for Fastlane
# More information about the Appfile: https://docs.fastlane.tools/advanced/#appfile

# =============================================================================
# ENVIRONMENT VARIABLE VALIDATION
# =============================================================================

def validate_appfile_env_vars
  required_vars = {
    "APPLE_ID" => "Your Apple ID email address (Apple Developer Account)",
    "DEVELOPMENT_TEAM" => "Your Apple Developer Team ID (found in Apple Developer Portal)",
    "APPSTORE_TEAM_ID" => "Your App Store Connect Team ID"
  }

  missing_vars = []

  required_vars.each do |var_name, description|
    if ENV[var_name].nil? || ENV[var_name].strip.empty?
      missing_vars << "❌ #{var_name}: #{description}"
    end
  end

  unless missing_vars.empty?
    puts "\n🚨 APPFILE CONFIGURATION ERROR 🚨"
    puts "\nThe following environment variables must be set in your .env file:"
    puts missing_vars.join("\n")
    puts "\n📝 Instructions:"
    puts "1. Copy .env.template to .env: cp .env.template .env"
    puts "2. Edit .env and fill in your Apple Developer account details"
    puts "3. Run: gh secret set -f .env (to push to GitHub secrets)"
    puts "4. Re-run your Fastlane command"
    puts "\n📖 For more help, see the README.md file."
    exit(1)
  end
end

# Validate environment variables before configuration
validate_appfile_env_vars

# =============================================================================
# APPLE DEVELOPER ACCOUNT CONFIGURATION
# =============================================================================

# Your Apple ID (Apple Developer Account email)
# REQUIRED: Set APPLE_ID in your .env file
apple_id(ENV["APPLE_ID"])

# Development Team ID (found in Apple Developer Portal)
# REQUIRED: Set DEVELOPMENT_TEAM in your .env file
team_id(ENV["DEVELOPMENT_TEAM"])

# App Store Connect Team ID (if different from development team)
# REQUIRED: Set APPSTORE_TEAM_ID in your .env file
itc_team_id(ENV["APPSTORE_TEAM_ID"])

# =============================================================================
# iOS APP CONFIGURATION
# =============================================================================

# For iOS platform
for_platform :ios do
  # iOS App Bundle Identifier
  # REQUIRED: Set IOS_BUNDLE_ID in your .env file
  if ENV["IOS_BUNDLE_ID"].nil? || ENV["IOS_BUNDLE_ID"].strip.empty?
    puts "❌ Error: IOS_BUNDLE_ID environment variable is required for iOS configuration"
    puts "📝 Set IOS_BUNDLE_ID in your .env file (e.g., 'com.company.myapp')"
    exit(1)
  end
  app_identifier(ENV["IOS_BUNDLE_ID"])

  # Apple ID of your iOS app (from App Store Connect)
  # OPTIONAL: Set IOS_APPLE_ID in your .env file (numeric ID from App Store Connect)
  if ENV["IOS_APPLE_ID"] && !ENV["IOS_APPLE_ID"].strip.empty?
    apple_id(ENV["IOS_APPLE_ID"])
  end
end

# =============================================================================
# MACOS APP CONFIGURATION
# =============================================================================

# For macOS platform
for_platform :mac do
  # macOS App Bundle Identifier
  # REQUIRED: Set MACOS_BUNDLE_ID in your .env file
  if ENV["MACOS_BUNDLE_ID"].nil? || ENV["MACOS_BUNDLE_ID"].strip.empty?
    puts "❌ Error: MACOS_BUNDLE_ID environment variable is required for macOS configuration"
    puts "📝 Set MACOS_BUNDLE_ID in your .env file (e.g., 'com.company.myapp.macos')"
    exit(1)
  end
  app_identifier(ENV["MACOS_BUNDLE_ID"])

  # Apple ID of your macOS app (from App Store Connect)
  # OPTIONAL: Set MACOS_APPLE_ID in your .env file (numeric ID from App Store Connect)
  if ENV["MACOS_APPLE_ID"] && !ENV["MACOS_APPLE_ID"].strip.empty?
    apple_id(ENV["MACOS_APPLE_ID"])
  end
end

# =============================================================================
# ADDITIONAL CONFIGURATION
# =============================================================================

# Xcode project/workspace path (relative to fastlane folder)
# TODO: Update these paths based on your actual project structure
# workspace("../YourAppName.xcworkspace")
# xcodeproj("../YourAppName.xcodeproj")

# =============================================================================
# CONFIGURATION NOTES
# =============================================================================

# To find your Team ID:
# 1. Log in to the Apple Developer Portal
# 2. Go to Account > Membership
# 3. Your Team ID is displayed next to your organization name

# To find your App ID:
# 1. Log in to App Store Connect
# 2. Go to My Apps
# 3. Select your app
# 4. The Apple ID is in the App Information section

# Environment Variables:
# You can set these in your .env file:
# APPLE_ID=your-apple-id@example.com
# DEVELOPMENT_TEAM=YOUR_DEVELOPMENT_TEAM_ID
# APPSTORE_TEAM_ID=YOUR_APPSTORE_TEAM_ID
# IOS_BUNDLE_ID=com.yourcompany.yourapp
# MACOS_BUNDLE_ID=com.yourcompany.yourapp.macos